<template>
    <div class="page container">
      <section class="embedded-svg-container">
        <img class="embedded-bulb bulb" :class="$store.state.pages >= 3.9 ? 'fade-in' : 'fade-out'" src="../../assets/images/icons/embedded_bulb.png" alt="">
        <svg
          xmlns:dc="http://purl.org/dc/elements/1.1/"
          xmlns:cc="http://creativecommons.org/ns#"
          xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
          xmlns:svg="http://www.w3.org/2000/svg"
          xmlns="http://www.w3.org/2000/svg"
          xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
          xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
          width="100%"
          height="47.8vw"
          viewBox="0 0 210 297"
          version="1.1"
          id="embedded-svg"
          inkscape:version="0.92.3 (2405546, 2018-03-11)"
          sodipodi:docname="嵌入式.svg">
          <defs
            id="defs711">
            <linearGradient
              id="embedded-start-line"
              spreadMethod="pad"
              gradientTransform="matrix(356.31612,0,0,-356.31612,-1.1932326,-172.19902)"
              gradientUnits="userSpaceOnUse"
              y2="0"
              x2="1"
              y1="0"
              x1="0.7">
              <stop
                id="stop174"
                offset="0"
                style="stop-opacity:1;stop-color:#39b54a" />
              <stop
                id="stop176"
                offset="1"
                style="stop-opacity:1;stop-color:#fcee21" />
            </linearGradient>
          </defs>
          <sodipodi:namedview
            id="base"
            pagecolor="#ffffff"
            bordercolor="#666666"
            borderopacity="1.0"
            inkscape:pageopacity="0.0"
            inkscape:pageshadow="2"
            inkscape:zoom="0.35"
            inkscape:cx="-98.571429"
            inkscape:cy="560"
            inkscape:document-units="mm"
            inkscape:current-layer="layer1"
            showgrid="false"
            inkscape:window-width="1920"
            inkscape:window-height="1001"
            inkscape:window-x="-9"
            inkscape:window-y="-9"
            inkscape:window-maximized="1" />
          <metadata
            id="metadata714">
            <rdf:RDF>
              <cc:Work
                rdf:about="">
                <dc:format>image/svg+xml</dc:format>
                <dc:type
                  rdf:resource="http://purl.org/dc/dcmitype/StillImage" />
                <dc:title></dc:title>
              </cc:Work>
            </rdf:RDF>
          </metadata>
          <g
            inkscape:label="Layer 1"
            inkscape:groupmode="layer"
            id="layer1">
            <path
              inkscape:connector-curvature="0"
              id="path180"
              style="fill:none;stroke:url(#embedded-start-line);stroke-width:5.64444399;stroke-linecap:butt;stroke-linejoin:round;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
              d="M -40.9912934,94.10486 -40.9912934,8.800707 432.29961,8.800707 v 0" />
            <path
              inkscape:connector-curvature="0"
              id="path184"
              style="fill:none;stroke:#39b54a;stroke-width:2.82222199;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
              d="m -56.261868,140.36045 c 10.0513454,-3.81846 20.1023364,-3.81846 30.153682,0 2.604555,0.98954 5.284255,-1.24707 4.737803,-3.97898 l -4.62421,-23.12035 c -1.448152,-7.24111 -7.8059146,-12.4534 -15.1906106,-12.4534 -7.384344,0 -13.7424584,5.21229 -15.1906114,12.4534 l -4.624211,23.12035 c -0.5461,2.73191 2.1336,4.96852 4.738158,3.97898 z" />
            <path
              inkscape:connector-curvature="0"
              id="path188"
              style="fill:none;stroke:#39b54a;stroke-width:2.30716658;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
              d="m -47.4319096,102.27957 c 4.25379498,-1.51588 8.507236,-1.51588 12.760677,0 l -2.552346,-8.52734 h -7.656336 z" />
            <path
              inkscape:connector-curvature="0"
              id="path192"
              style="fill:none;stroke:#39b54a;stroke-width:2.30716658;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
              d="m -37.2246234,110.15625 h -8.466666" />
            <path
              inkscape:connector-curvature="0"
              id="path196"
              style="fill:none;stroke:#39b54a;stroke-width:2.30716658;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
              d="m -37.2246234,113.33125 h -8.466666" />
            <path
              inkscape:connector-curvature="0"
              id="path200"
              style="fill:none;stroke:#39b54a;stroke-width:2.30716658;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
              d="m -37.2246234,116.50625 h -8.466666" />
            <path
              inkscape:connector-curvature="0"
              id="path202"
              style="fill:none;stroke:#39b54a;stroke-width:2.9181776;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
              d="m -45.2420406,128.14793 h 8.466666 v -5.64444 h -8.466666 z" />
            <path
              inkscape:connector-curvature="0"
              id="path206"
              style="fill:none;stroke:#39b54a;stroke-width:2.82222199;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
              d="m 32.872236,229.21428 c 3.818467,-10.05099 3.818467,-20.10234 0,-30.15369 -0.989541,-2.60455 1.246717,-5.28425 3.978982,-4.7378 l 23.120352,4.62386 c 7.24111,1.4485 12.45341,7.80626 12.45341,15.19095 0,7.38434 -5.2123,13.74246 -12.45341,15.19061 l -23.120352,4.62423 c -2.732265,0.5461 -4.968523,-2.13326 -3.978982,-4.73816 z" />
            <path
              inkscape:connector-curvature="0"
              id="path210"
              style="fill:none;stroke:#39b54a;stroke-width:2.30716658;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
              d="m 70.95312,220.38413 c 1.51588,-4.25345 1.51588,-8.50689 0,-12.76067 l 8.52734,2.55235 v 7.65633 z" />
            <path
              inkscape:connector-curvature="0"
              id="path214"
              style="fill:none;stroke:#39b54a;stroke-width:2.30716658;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
              d="m 63.07622,209.72779 v 8.46667" />
            <path
              inkscape:connector-curvature="0"
              id="path218"
              style="fill:none;stroke:#39b54a;stroke-width:2.30716658;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
              d="m 59.90122,209.72779 v 8.46667" />
            <path
              inkscape:connector-curvature="0"
              id="path222"
              style="fill:none;stroke:#39b54a;stroke-width:2.30716658;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
              d="m 56.726217,209.72779 v 8.46667" />
            <path
              inkscape:connector-curvature="0"
              id="path224"
              style="fill:none;stroke:#39b54a;stroke-width:2.9181776;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
              d="m 45.084588,209.72779 h 5.644449 v 8.46667 h -5.644449 z" />
            <path
              inkscape:connector-curvature="0"
              id="path228"
              style="fill:none;stroke:#39b54a;stroke-width:5.64444399;stroke-linecap:butt;stroke-linejoin:round;stroke-miterlimit:10;stroke-dasharray:none;stroke-opacity:1"
              d="m 79.72949,214.1375 34.53402,-0.0882 v 111.83054" />
          </g>
        </svg>
      </section>
      <section class="embedded-intro-container">
        <div class="embedded-word-bg"></div>
        <div class="embedded-intro">
          <span class="major-name">嵌入式</span>
          <span class="major-intro">
            作为计算机学院历史最悠久、实力最强的嵌入式开发团<br>
            队。小组内部有着丰富的开发资源及技术传承，主要研<br>
            究方向为基于ARM+LINUX平台以及其他各类开发板的<br>
            嵌入式软件开发。小组的学习之旅主要伴随着比赛，近<br>
            年来获得过许多奖项，第十四届“挑战杯”全国大学生<br>
            课外学术科技作品竞赛香港专项赛特等奖更是刷新了学<br>
            校在挑战杯获奖层次的记录。加入我们，和我们一起刷<br>
            奖吧。
          </span>
        </div>
        <div class="arrow-container">
          <div class="turn-page">
              <img src="../../assets/images/icons/embedded_arrow.png" alt="">
              <span>向下滚动了解更多</span>
          </div>
        </div>
      </section>
    </div>
</template>

<script>
import pathUtil from '../../../utils/pathAnimate.js';
export default {
  watch: {
    '$store.state.embedded': {
      handler(newValue, oldValue) {
        this.pathAnimate(newValue, oldValue)
      },
      deep: true
    },
    '$store.state.pages': (pages) => {
      let pathList = $('#embedded-svg path');
      pathUtil.correctEndPath(pathList[0], pathList.slice(1, 7), pages, 3.5, 0.4);
      pathUtil.correctStartPath(pathList[13], pathList.slice(7, 13), pages, 4, 0.2);
    }
  },
  methods: {
    pathAnimate(newValue, oldValue) {
      let insidePercent;
      let height = $(window).height();
      let percent = ($(window).scrollTop() % height) / height;   // 计算翻页时候翻过当前页面的百分之几
      let pathList = $('#embedded-svg path');
      if (percent >= 0.5 && percent <= 1) {
        insidePercent = pathUtil.getEndInsidePer(percent, 0.9);
        if (percent < 0.9) {
          // 这条线需要动画是反过来的，这是设计师画的方向总是从灯座发起的
          pathUtil.lineAnimate(pathList[0], insidePercent, true);
        } else {
          pathUtil.socketAnimate(pathList.slice(1, 7), insidePercent, false);
        }
      } else {
        insidePercent = pathUtil.getStartInsidePer(percent, 0.2);
        if (percent < 0.2) {
          pathUtil.socketAnimate(pathList.slice(7, 13), insidePercent, true);
        } else {
          pathUtil.lineAnimate(pathList[13], insidePercent);
        }
      }
    }
  }
}
</script>

<style scoped>
@media only screen and (min-width: 740px) {
  .container {
    background: url(../../assets/images/background/embedded_background.png) center center no-repeat;
    background-size: cover;
  }
  .embedded-word-bg {
    position: absolute;
    z-index: 1;
    right: 3.2rem;
    bottom: 3.5rem;
    background-color: rgba(57, 181, 74, .3);
    width: 6.9rem;
    height: 4.1rem;
  }
  .embedded-svg-container {
    position: absolute;
    width: 100%;
    height: 47.8vw;
    bottom: 0;
  }
  .embedded-svg-container::after,
  .embedded-intro::after {
    content: "";
    display: block;
    clear: both;
  }
  .embedded-bulb {
    position: absolute;
    width: 5.5rem;
    height: 5.5rem;
    bottom: -0.15rem;
    left: 2.35rem;
  }
  .embedded-intro-container {
    position: absolute;
    width: 100%;
    height: 100%;
  }
  .embedded-intro {
    position: absolute;
    z-index: 2;
    width: 8rem;
    bottom: 3.3rem;
    right: 2.2rem;
    border-left: 0.09rem solid #39b54a;
    padding-left: 0.48rem;
  }
  .major-name {
    position: absolute;
    font-size: 0.72rem;
    color: #7fb586;
    top: -0.6rem;
    left: 0.16rem;
  }
  .major-intro {
    display: block;
    margin-top: 0.48rem;
    font-size: 0.32rem;
    color: #cfe6d2;
  }
  .arrow-container {
    font-family: "SourceHanSansCN-Regular";
    position: absolute;
    width: 5rem;
    height: 3rem;
    bottom: -0.4rem;
    right: 3.4rem;
  }
}
</style>